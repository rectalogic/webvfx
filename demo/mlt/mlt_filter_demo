#!/bin/bash

BASEDIR=$(dirname "${BASH_SOURCE[0]}")
$BASEDIR/create_mov
export DISPLAY=${DISPLAY:-:0}
case ${PLUGIN:-frei0r} in
frei0r)
    FILTER=("frei0r.vfxpipe_filter" "0=\"webvfx_frameserver --width {{width}} --height {{height}} --duration 300/30 ${BASEDIR}/../examples/filter-demo.qml\"")
    ;;
mlt)
    FILTER=(mltpipe:"webvfx_frameserver --width {{width}} --height {{height}} ${BASEDIR}/../examples/filter-demo.qml")
    ;;
esac
melt -verbose "${VFX_SOURCE:-${BASEDIR}/red.mov}" out=299 \
    -filter "${FILTER[@]}" out=299 \
    $(eval echo $(< "${VFX_CONSUMER:-${BASEDIR}/consumer_sdl}")) mlt_profile=${BASEDIR}/webvfx_profile
